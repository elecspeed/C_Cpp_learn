## 章节

> 1. 词法“陷阱”
> 2. 语法“陷阱”
> 3. 语义“陷阱”
> 4. 链接
> 5. ***库函数***
> 6. 预处理
> 7. 可移植性
> 8. 建议
> 9. 附录

---

#### 5.1 返回 int 的 getchar

看代码：

```C
#include <stdio.h>
int main()
{
    char ch;
    while((ch = getchar()) != EOF)
        putchar(ch);
    return 0;
}
```

这个程序乍一看似乎是把标准输入复制到标准输出，实则不然。函数`getchar`返回 int 类型而 ch 是 char 类型，意味着 ch 可能无法容下所有字符（有些编译器把 char 实现为有符号类型，范围是 -128~127；有些则是实现为无符号类型，范围是 0~255）

#### 5.2 更新顺序文件

> 顺序文件：*文件内容的逻辑顺序 与 实际存储的物理顺序一致*的文件

为了保持与过去的程序的兼容性，以“读写”打开的文件，一个输入操作后不能直接跟一个输出操作，反之亦然。输入和输出操作之间要有`fseek`函数，`fseek`函数能改变文件的状态。

#### 5.3 缓冲输出与内存分配

使用缓冲区要注意最后一次的清空。设置缓冲区的函数`setbuf`和`setvbuf`。

#### 5.4 使用 errno 检测错误

```C
printf("%s\n", strerror(errno));
```

需要引用库文件`<errno.h>`。

#### 5.5 库函数 signal

