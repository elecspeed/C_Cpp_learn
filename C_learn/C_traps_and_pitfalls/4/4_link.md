## 章节

> 1. 词法“陷阱”
> 2. 语法“陷阱”
> 3. 语义“陷阱”
> 4. ***链接***
> 5. 库函数
> 6. 预处理
> 7. 可移植性
> 8. 建议
> 9. 附录

---

## 链接

第一章提到，从 C 源文件到可执行文件要经过四个步骤：预处理、编译、汇编和链接，每一个步骤都由相应的程序——预处理器、编译器、汇编器、链接器——来实现。其中，链接部分由`链接器（linker 或 link editor）`实现。

#### 4.1 什么是链接器

C 语言中的一个重要思想是`分别编译（separate compilation）`，即，若干个源文件可以在不同的时候单独编译，在恰当的时候整合在一起。（此处编译包括了预处理和汇编。具体请看《编译原理》）。

问题来了，编译器一般每次只处理一个文件，不能检测出多文件之间出现的冲突；而**在许多系统中，链接器与 C 编译器是分离的**，链接器不了解 C 语言的诸多细节。因此，很多文件间的错误不能被检测发现。

那么，单个文件内不会出现，而多个文件之间却有可能出现的错误是什么？有哪些这样的错误？实践发现，主要的、出现最多的错误是`命名冲突`。

解决办法是，在编译时留下一些信息。编译过程中除了*词法分析、语法分析和语义分析*之外，还有一个重要的步骤——`符号汇总`，汇总后的`符号表`将用于汇编和链接。而链接器要做的就是，根据符号表来匹配文件间对应的全局变量、函数名等等，处理文件间的命名冲突。

#### 4.2 声明与定义

比较下面三条声明语句。

```C
int a;        // 1（注：声明在所有函数外）
int a = 1;    // 2
extern int a; // 3
```

语句 1 说明 a 是一个外部整型变量（或全局整型变量），同时为 a 分配了内存，初始值默认为 0；语句 2 为 a 分配内存，也说明了在该内存中存储的值；语句 3 是一个对外部变量 a 的引用声明，而不是定义，语句 3 不为 a 分配内存。

如果同一个全局变量的定义不止一次，又将如何？与系统有关。严格的要求是，每个全局变量只能定义一次。
